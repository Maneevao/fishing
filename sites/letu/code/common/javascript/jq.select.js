/*
 * jQuery Selectbox plugin 0.1.3
 *
 * Copyright 2011, Dimitar Ivanov (http://www.bulgaria-web-developers.com/projects/javascript/selectbox/)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 *
 * Date: Wed Jul 29 23:20:57 2011 +0200
 */
(function(a,b){function g(){this._state=[];this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",speed:200,effect:"slide",onChange:null,onOpen:null,onClose:null}}var c="selectbox",d=false,e=true;var f="";a.extend(g.prototype,{_isOpenSelectbox:function(a){if(!a){return d}var b=this._getInst(a);return b.isOpen},_isDisabledSelectbox:function(a){if(!a){return d}var b=this._getInst(a);return b.isDisabled},_attachSelectbox:function(b,g){function s(){var b,c=this.attr("id").split("_")[1];for(b in i._state){if(b!==c){if(i._state.hasOwnProperty(b)){if(a(":input[sb='"+b+"']")[0]){i._closeSelectbox(a(":input[sb='"+b+"']")[0])}}}}}function t(){var c=arguments[1]&&arguments[1].sub?true:false,d=arguments[1]&&arguments[1].disabled?true:false;arguments[0].each(function(f){var g=a(this),h=a("<li>"),k;if(g.is(":selected")){l.text(g.text());o=e}if(f===r-1){h.addClass("last")}if(!g.is(":disabled")&&!d){k=a("<a>",{href:g.val(),rel:g.val(),text:g.text(),click:function(c){c.preventDefault();var d=m,e=d.attr("id").split("_")[1];i._changeSelectbox(b,a(this).attr("rel"),a(this).text());i._closeSelectbox(b)}});if(c){k.addClass(j.settings.classSub)}k.appendTo(h)}else{k=a("<span>",{text:g.text()}).addClass(j.settings.classDisabled);if(c){k.addClass(j.settings.classSub)}k.appendTo(h)}h.appendTo(n)})}if(this._getInst(b)){return d}var h=a(b),i=this,j=i._newInst(h),k,l,m,n,o=d,p=h.find("optgroup"),q=h.find("option"),r=q.length;h.attr("sb",j.uid);a.extend(j.settings,i._defaults,g);i._state[j.uid]=d;h.hide();k=a("<div>",{id:"sbHolder_"+j.uid,"class":j.settings.classHolder});l=a("<a>",{id:"sbSelector_"+j.uid,href:"#","class":j.settings.classSelector,click:function(c){c.preventDefault();s.apply(a(this),[]);var d=a(this).attr("id").split("_")[1];if(i._state[d]){i._closeSelectbox(b)}else{i._openSelectbox(b)}}});m=a("<a>",{id:"sbToggle_"+j.uid,href:"#","class":j.settings.classToggle,click:function(c){c.preventDefault();s.apply(a(this),[]);var d=a(this).attr("id").split("_")[1];if(i._state[d]){i._closeSelectbox(b)}else{i._openSelectbox(b)}}});m.appendTo(k);n=a("<ul>",{id:"sbOptions_"+j.uid,"class":j.settings.classOptions,css:{display:"none"}});h.children().each(function(b){var c=a(this),d,e={};if(c.is("option")){t(c)}else{if(c.is("optgroup")){d=a("<li>");a("<span>",{text:c.attr("label")}).addClass(j.settings.classGroup).appendTo(d);d.appendTo(n);if(c.is(":disabled")){e.disabled=true}e.sub=true;t(c.find("option"),e)}}});if(!o){l.text(q.first().text())}a.data(b,c,j);l.appendTo(k);f=l.text();n.appendTo(k);k.insertAfter(h)},_detachSelectbox:function(b){var e=this._getInst(b);if(!e){return d}a("#sbHolder_"+e.uid).remove();a.data(b,c,null);a(b).show()},_changeSelectbox:function(b,c,d){var f=this._getInst(b),g=this._get(f,"onChange");a("#sbSelector_"+f.uid).text(d);a(b).find("option[value='"+c+"']").attr("selected",e);if(g){g.apply(f.input?f.input[0]:null,[c,f])}else{if(f.input){f.input.trigger("change")}}},_enableSelectbox:function(b){var e=this._getInst(b);if(!e||!e.isDisabled){return d}a("#sbHolder_"+e.uid).removeClass(e.settings.classHolderDisabled);e.isDisabled=d;a.data(b,c,e)},_disableSelectbox:function(b){var f=this._getInst(b);if(!f||f.isDisabled){return d}a("#sbHolder_"+f.uid).addClass(f.settings.classHolderDisabled);f.isDisabled=e;a.data(b,c,f)},_optionSelectbox:function(b,e,f){var g=this._getInst(b);if(!g){return d}g[e]=f;a.data(b,c,g)},_openSelectbox:function(b){a(".sbOptions li:first").css("display","none");a(".sbSelector").html("");var d=this._getInst(b);if(!d||d.isOpen||d.isDisabled){return}var f=a("#sbOptions_"+d.uid),g=parseInt(a(window).height(),10),h=a("#sbHolder_"+d.uid).offset(),i=a(window).scrollTop(),j=f.prev().height()+1,k=g-(h.top-i)-j/2,l=this._get(d,"onOpen");f.css({top:j+"px",maxHeight:k-j-150+"px"});if(a.browser.msie&&a.browser.version=="8.0"){a(".brands .brandBlock .sbHolder .sbOptions").boxShadow("0px 0px 11px #001a34");a(".brands .brandBlock .sbHolder .sbOptions+div").hide();setTimeout("$('.brands .brandBlock .sbHolder .sbOptions+div').show()",200)}d.settings.effect==="fade"?f.fadeIn(d.settings.speed):f.slideDown(d.settings.speed);a("#sbToggle_"+d.uid).addClass(d.settings.classToggleOpen);this._state[d.uid]=e;d.isOpen=e;if(l){l.apply(d.input?d.input[0]:null,[d])}a.data(b,c,d)},_closeSelectbox:function(b){var e=this._getInst(b);if(!e||!e.isOpen){return}var g=this._get(e,"onClose");e.settings.effect==="fade"?a("#sbOptions_"+e.uid).fadeOut(e.settings.speed):a("#sbOptions_"+e.uid).slideUp(e.settings.speed);a("#sbToggle_"+e.uid).removeClass(e.settings.classToggleOpen);a(".sbOptions + div").remove();this._state[e.uid]=d;e.isOpen=d;if(g){g.apply(e.input?e.input[0]:null,[e])}a.data(b,c,e);if(a.trim(a(".sbSelector").html())==""){a(".sbSelector").html(f)}},_newInst:function(a){var b=a[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:b,input:a,uid:Math.floor(Math.random()*99999999),isOpen:d,isDisabled:d,settings:{}}},_getInst:function(b){try{return a.data(b,c)}catch(d){throw"Missing instance data for this selectbox"}},_get:function(a,c){return a.settings[c]!==b?a.settings[c]:this._defaults[c]}});a.fn.selectbox=function(b){var c=Array.prototype.slice.call(arguments,1);if(typeof b=="string"&&b=="isDisabled"){return a.selectbox["_"+b+"Selectbox"].apply(a.selectbox,[this[0]].concat(c))}if(b=="option"&&arguments.length==2&&typeof arguments[1]=="string"){return a.selectbox["_"+b+"Selectbox"].apply(a.selectbox,[this[0]].concat(c))}return this.each(function(){typeof b=="string"?a.selectbox["_"+b+"Selectbox"].apply(a.selectbox,[this].concat(c)):a.selectbox._attachSelectbox(this,b)})};a.selectbox=new g;a.selectbox.version="0.1.3"})(jQuery)