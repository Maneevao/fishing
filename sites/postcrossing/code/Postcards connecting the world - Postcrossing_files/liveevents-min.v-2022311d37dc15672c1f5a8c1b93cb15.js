var requests=0,events_event_interval=3,events_threshold=7,events_max_pulls=6,events_progressive_inc=10,events_url="/liveEvents/getLast",pullInterval=30,printTimer,fetcherTimer,lastId,xmlhttp=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");
xmlhttp.onreadystatechange=function(){if(4==xmlhttp.readyState&&200==xmlhttp.status&&xmlhttp.getResponseHeader("X-JSON"))for(var e=eval(xmlhttp.getResponseHeader("X-JSON")),c=0;c<e.length;c++)events.unshift(e[c]),lastId=Math.max(lastId,e[c][0])};
function smoothScroll(e,c){var a=document.getElementById("liveEvents"),d=a.scrollTop,b=a.scrollHeight,b=b==a.scrollHeight?b:d+b,a=b>d?d+1:d-1,f=0;if(b>d)for(;d<b;d+=1)setTimeout("document.getElementById('liveEvents').scrollTop="+a,10*f),a+=1,a>b&&(a=b),f++}
function printEvent(e){var c="event-"+e[0],a=document.createElement("div");a.setAttribute("id",c);a.setAttribute("class","liveEvent");a.style.padding="5px";a.innerHTML=e[1];document.getElementById("liveEvents").appendChild(a);smoothScroll("liveEvents",document.getElementById(c).scrollHeight)}function printEvents(){events.length&&printEvent(events.pop());printTimer=setTimeout("printEvents()",1E3*events_event_interval)}
function fetcher(){events.length<events_threshold&&(xmlhttp.open("GET",events_url+"?lastEventId="+lastId,!0),xmlhttp.send(),requests++);requests<events_max_pulls&&(pullInterval+=events_progressive_inc,fetcherTimer=setTimeout("fetcher()",1E3*pullInterval))}for(var i=1;8>i;i++)if(events.length)printEvent(events.pop());else break;printEvents();fetcher();function onBlur(){clearTimeout(printTimer);clearTimeout(fetcherTimer)}
function onFocus(){clearTimeout(printTimer);printTimer=setTimeout("printEvents()",1E3*events_event_interval);clearTimeout(fetcherTimer);fetcherTimer=setTimeout("fetcher()",1E3*pullInterval)}+"\v1"?(window.onfocus=onFocus,window.onblur=onBlur):(document.onfocusin=onFocus,document.onfocusout=onBlur);
